#!/bin/bash
#!/bin/bash
# Latest Atom beta release available, e.g. 1.28.0-beta2
if `which curl > /dev/null 2>&1`; then
    pkgverb=$(curl -sL https://github.com/atom/atom/releases | grep "beta" | grep "amd64\.tar\.gz" | head -n 1 | cut -d '"' -f 2 | cut -d '/' -f 6 | sed 's/v//g')
elif `which wget > /dev/null 2>&1`; then
    pkgverb=$(wget -cqO- https://github.com/atom/atom/releases | grep "beta" | grep "amd64\.tar\.gz" | head -n 1 | cut -d '"' -f 2 | cut -d '/' -f 6 | sed 's/v//g')
else
    zenity --error --text="Neither cURL nor wget are detected, please install them, or if installed add to system PATH." --title="Warning!" && exit
fi

# Latest Atom stable release available
if `which curl > /dev/null 2>&1`; then
    pkgvers=$(curl -sL https://github.com/atom/atom/releases | grep -v "beta\|dev" | grep "a href" | grep "amd64\.tar\.gz" | head -n 1 | cut -d '"' -f 2 | cut -d '/' -f 6 | sed 's/v//g')
elif `which wget > /dev/null 2>&1`; then
    pkgvers=$(wget -cqO- https://github.com/atom/atom/releases | grep -v "beta\|dev" | grep "a href" | grep "amd64\.tar\.gz" | head -n 1 | cut -d '"' -f 2 | cut -d '/' -f 6 | sed 's/v//g')
fi

# The number that comes after "beta" in the release number (e.g. 2 for 1.28.0-beta2)
pkgbv=$(echo $pkgverb | cut -d '-' -f 2 | sed 's/beta//g')
# The number that comes before beta in the release number
pkgnbv=$(echo $pkgverb | cut -d '-' -f 1)
cd /data/AUR/atom-editor-beta
pkgpnbv=$(sed -n 's/_pkgver=//p' PKGBUILD)
pkgpbv=$(sed -n 's/_pkgrel=//p' PKGBUILD)
pkgpvers=$(ls /data/GitHub/mine/packaging/fusion809-overlay/app-editors/atom-bin/*.ebuild | grep -v "beta" | cut -d '/' -f 9 | cut -d '-' -f 3 | sed 's/.ebuild//g')
pkgpverb=${pkgpnbv}.${pkgpbv}
pkgverb=${pkgnbv}.${pkgbv}

if ! [[ $pkgvers == $pkgpvers ]]; then
    zenity --error --text="A new Atom stable release (${pkgvers}) is available!" --title="Warning!"    
fi

if ! [[ $pkgverb == $pkgpverb ]]; then
    zenity --error --text="A new Atom beta release (${pkgnbv}-beta${pkgbv}) is available! Remember to update it in both fusion809-overlay and atom-editor-beta." --title="Warning!"    
fi
